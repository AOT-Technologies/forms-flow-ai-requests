name: Tenant Request

on:
  issues:
    types: [opened, edited]
jobs:
  create-tenant:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Add initial comment
        uses: peter-evans/create-or-update-comment@a35cf36e5301d70b76f316e867e7788a55a31dae
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            We are working on it :sparkles: Thank you for your interest! :sparkles:
            
      - name: Parse issue
        uses: stefanbuck/github-issue-parser@v2
        id: issue-parser

      - name: Create tenant
        env:
          PAYLOAD: '{"key": "${{ fromJson(steps.issue-parser.outputs.jsonString).tenant_key }}", "name": "${{ fromJson(steps.issue-parser.outputs.jsonString).tenant_name }}", "details": {"applicationTitle": "${{ fromJson(steps.issue-parser.outputs.jsonString).tenant_title}}", "roles": [] } }'

        run: |
          curl --write-out '%{http_code}' -X POST '${{ secrets.TENANT_ENDPOINT }}' -H 'content-type: application/json' -d ${PAYLOAD} > response
          echo ${response}
          #if $response == "200"
          #echo "message=Success" >> $GITHUB_ENV
          #else
          #echo "message=Failed" >> $GITHUB_ENV
          #fi
     # - name: Update Status
     #   uses: peter-evans/create-or-update-comment@a35cf36e5301d70b76f316e867e7788a55a31dae
     #   with:
     #     issue-number: ${{ github.event.issue.number }}
     #     body: |
     #       Status : ${{ env.RESPONSE }}
            


